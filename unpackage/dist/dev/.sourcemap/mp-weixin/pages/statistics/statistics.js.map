{"version":3,"file":"statistics.js","sources":["pages/statistics/statistics.vue","D:/HBuilderX.4.45.2025010502/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvc3RhdGlzdGljcy9zdGF0aXN0aWNzLnZ1ZQ"],"sourcesContent":["<template>\n  <view class=\"statistics-container\">\n    <!-- 统计图表 -->\n    <l-echart ref=\"chartRef\" @finished=\"init\" style=\"width: 100%; height: 400px;\"></l-echart>\n  </view>\n</template>\n\n<script>\t\r\n\r\nconst echarts = require('../../uni_modules/lime-echart/static/echarts.min');\r\nconst chart = null;\nexport default {\n  data() {\n    return {\n      bills: [], // 用来存储账单数据\n      categories: [\n        { name: '购物', color: '#ff6b6b', type: 'expense' },\n        { name: '餐饮', color: '#48dbfb', type: 'expense' },\n        { name: '交通', color: '#f368e0', type: 'expense' },\n        { name: '娱乐', color: '#ff9f1c', type: 'expense' },\n        { name: '房屋', color: '#eb3b5a', type: 'expense' },\n        { name: '工资', color: '#1dd1a1', type: 'income' },\n        { name: '奖金', color: '#2ecc71', type: 'income' }\n      ],\n      viewType: 'monthly', // 默认显示当月统计\n      currentYear: new Date().getFullYear(),\n      years: [], // 存储可选择的年份\n      pieChartInstance: null,\n      barChartInstance: null\n    };\n  },\n  mounted() {\n   \n  },\n  methods: {\t  \r\n\tinit(){\r\n\t\tthis.loadEcharts();\r\n\t\tthis.loadBills();\r\n\t\tthis.initYears();\t\t\t  \r\n\t},\n    loadEcharts() {\n      // 使用微信小程序的 require 方法加载 echarts\n      \n      if (this.viewType === 'monthly') {\n        this.drawPieChart();\n      } else {\n        this.drawBarChart();\n      }\n    },\n    loadBills() {\n      const storedBills = uni.getStorageSync('bills') || [];\n      this.bills = storedBills;\n    },\n    initYears() {\n      const minYear = Math.min(...this.bills.map(bill => new Date(bill.date).getFullYear()));\n      const maxYear = new Date().getFullYear();\n      for (let year = minYear; year <= maxYear; year++) {\n        this.years.push(year);\n      }\n    },\n    setViewType(type) {\n      this.viewType = type;\n      if (type === 'monthly') {\n        this.drawPieChart();\n      } else if (type === 'yearly') {\n        this.drawBarChart();\n      }\n    },\n    onYearChange(e) {\n      this.currentYear = this.years[e.detail.value];\n      this.drawBarChart();\n    },\n    drawPieChart() {\n      const query = uni.createSelectorQuery().in(this);\n      query.select('#pieChart').fields({ node: true, size: true }).exec((res) => {\n        if (res[0] && res[0].node) {\n          const canvas = res[0].node;\n          const ctx = canvas.getContext('2d');\n          const width = res[0].width;\n          const height = res[0].height;\n\n          if (this.pieChartInstance) {\n            this.pieChartInstance.dispose();\n          }\n\n          this.pieChartInstance = this.$refs.chart(canvas, null, {\n            width: width,\n            height: height,\n            devicePixelRatio: uni.getSystemInfoSync().pixelRatio\n          });\n\n          this.updatePieChart();\n        }\n      });\n    },\n    updatePieChart() {\n      const option = {\n        title: {\n          text: '当月账单分类统计',\n          left: 'center'\n        },\n        tooltip: {\n          trigger: 'item'\n        },\n        legend: {\n          orient: 'vertical',\n          left: 'left'\n        },\n        series: [\n          {\n            name: '金额',\n            type: 'pie',\n            radius: '50%',\n            data: this.monthlyData,\n            emphasis: {\n              itemStyle: {\n                shadowBlur: 10,\n                shadowOffsetX: 0,\n                shadowColor: 'rgba(0, 0, 0, 0.5)'\n              }\n            }\n          }\n        ]\n      };\n      this.pieChartInstance.setOption(option);\n    },\n    drawBarChart() {\n      const query = uni.createSelectorQuery().in(this);\n      query.select('#barChart').fields({ node: true, size: true }).exec((res) => {\n        if (res[0] && res[0].node) {\n          const canvas = res[0].node;\n          const ctx = canvas.getContext('2d');\n          const width = res[0].width;\n          const height = res[0].height;\n\n          if (this.barChartInstance) {\n            this.barChartInstance.dispose();\n          }\n\n          this.barChartInstance = this.$refs.chart.init(canvas, null, {\n            width: width,\n            height: height,\n            devicePixelRatio: uni.getSystemInfoSync().pixelRatio\n          });\n\n          this.updateBarChart();\n        }\n      });\n    },\n    updateBarChart() {\n      const months = ['1月', '2月', '3月', '4月', '5月', '6月', '7月', '8月', '9月', '10月', '11月', '12月'];\n      const data = this.yearlyData;\n\n      const option = {\n        title: {\n          text: `${this.currentYear}年每月收支统计`,\n          left: 'center'\n        },\n        tooltip: {\n          trigger: 'axis',\n          axisPointer: {\n            type: 'shadow'\n          }\n        },\n        legend: {\n          data: ['收入', '支出'],\n          top: '10%'\n        },\n        xAxis: {\n          type: 'category',\n          data: months\n        },\n        yAxis: {\n          type: 'value'\n        },\n        series: [\n          {\n            name: '收入',\n            type: 'bar',\n            stack: 'total',\n            label: {\n              show: true\n            },\n            emphasis: {\n              focus: 'series'\n            },\n            data: data.map(item => item.income)\n          },\n          {\n            name: '支出',\n            type: 'bar',\n            stack: 'total',\n            label: {\n              show: true\n            },\n            emphasis: {\n              focus: 'series'\n            },\n            data: data.map(item => item.expense)\n          }\n        ]\n      };\n\n      this.barChartInstance.setOption(option);\n    }\n  },\n  computed: {\n    monthlyData() {\n      const year = new Date().getFullYear();\n      const month = new Date().getMonth();\n      const filteredBills = this.bills.filter(bill => {\n        const billDate = new Date(bill.date);\n        return billDate.getFullYear() === year && billDate.getMonth() === month;\n      });\n\n      const categoryTotals = {};\n      filteredBills.forEach(bill => {\n        if (!categoryTotals[bill.category]) {\n          categoryTotals[bill.category] = 0;\n        }\n        categoryTotals[bill.category] += Number(bill.amount);\n      });\n\n      return Object.keys(categoryTotals).map(category => ({\n        name: category,\n        value: categoryTotals[category]\n      }));\n    },\n    yearlyData() {\n      const year = this.currentYear;\n      const filteredBills = this.bills.filter(bill => {\n        const billDate = new Date(bill.date);\n        return billDate.getFullYear() === year;\n      });\n\n      const monthlyTotals = Array(12).fill({ income: 0, expense: 0 });\n      filteredBills.forEach(bill => {\n        const monthIndex = new Date(bill.date).getMonth();\n        if (Number(bill.amount) > 0) {\n          monthlyTotals[monthIndex].income += Number(bill.amount);\n        } else {\n          monthlyTotals[monthIndex].expense -= Number(bill.amount);\n        }\n      });\n\n      return monthlyTotals.map((total, index) => ({\n        month: index + 1,\n        income: total.income,\n        expense: total.expense\n      }));\n    }\n  }\n};\n</script>\n<style scoped>\n/* 整体容器样式 */\n.statistics-container {\n  padding: 20px;\n  background-color: #f5f5f5;\n  height: calc(100vh - 60px); /* 减去底部导航栏的高度 */\n  box-sizing: border-box;\n}\n\n</style>\n","import MiniProgramPage from 'E:/HBuilderProjects/BillRecord/pages/statistics/statistics.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni"],"mappings":"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"}