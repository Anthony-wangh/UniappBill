"use strict";const t=require("../../common/vendor.js"),e={components:{PieChart:()=>"../../components/Chart/PieChart.js",ColumnChart:()=>"../../components/Chart/ColumnChart.js"},data:()=>({columnChartData:{categories:["2018","2019","2020","2021","2022","2023"],series:[{name:"目标值",data:[35,36,31,33,13,34]},{name:"完成量",data:[18,27,21,24,6,28]}]},groupBills:[],chartData:{series:[{data:[{name:"一班",value:256},{name:"二班",value:123},{name:"三班",value:20},{name:"四班",value:0},{name:"五班",value:0}]}]},bills:[],billsInCurrentMouth:[],categories:[{name:"购物",color:"#ff6b6b",type:"expense"},{name:"餐饮",color:"#48dbfb",type:"expense"},{name:"交通",color:"#f368e0",type:"expense"},{name:"房屋",color:"#eb3b5a",type:"expense"}],currentDate:new Date}),onShow(){this.loadBills(),this.update()},computed:{currentMonth(){return this.currentDate.toLocaleDateString("zh-CN",{year:"numeric",month:"long"})}},methods:{update(){this.filterBillsByMonth(),this.updatePieChart(),this.updateColumnChart(),this.$refs.pieChart.drawCharts(this.chartData),this.$refs.columnChart.drawCharts(this.columnChartData)},loadBills(){const e=t.index.getStorageSync("bills")||[];this.bills=e},filterBillsByMonth(){const t=this.currentDate.getFullYear(),e=this.currentDate.getMonth();this.billsInCurrentMouth=this.bills.filter((a=>{const n=new Date(a.time);return n.getFullYear()===t&&n.getMonth()===e}))},updatePieChart(){const t=[];this.categories.forEach((e=>{const a={};a.name=e.name;const n=this.billsInCurrentMouth.filter((t=>t.category===e.name)).reduce(((t,e)=>t+Number(e.amount)),0).toFixed(2);a.value=Number(n),t.push(a)}));var e={};const a={};a.data=t,e.series=[a],this.chartData=e,this.groupBills=t.sort(((t,e)=>t.value>e.value))},updateColumnChart(){const t={},e={},a=[];this.billsInCurrentMouth.forEach((n=>{const r=new Date(n.time).getDay().toString();"expense"===n.type?(t[r]||(t[r]=0,-1===a.findIndex((t=>t===r))&&a.push(r)),t[r]=t[r]+Number(n.amount)):(e[r]||(e[r]=0,-1===a.findIndex((t=>t===r))&&a.push(r)),e[r]=e[r]+Number(n.amount))}));const n=[],r=[];a.forEach((a=>{e[a]?n.push(e[a]):n.push(0),t[a]?r.push(t[a]):r.push(0)}));var o={};const s={name:"支出",data:r},h={name:"收入",data:n};o.categories=a,o.series=[s,h],this.columnChartData=o},changeMonth(t){const e=new Date(this.currentDate);e.setMonth(e.getMonth()+t),this.currentDate=e,this.update()},getCategoryColor(t){const e=this.categories.find((e=>e.name===t));return e?e.color:"#cccccc"}}};if(!Array){(t.resolveComponent("PieChart")+t.resolveComponent("ColumnChart"))()}const a=t._export_sfc(e,[["render",function(e,a,n,r,o,s){return t.e({a:t.o((t=>s.changeMonth(-1))),b:t.t(s.currentMonth),c:t.o((t=>s.changeMonth(1))),d:0===Object.keys(o.groupBills).length},(Object.keys(o.groupBills).length,{}),{e:t.sr("pieChart","380879e3-0"),f:t.p({canvasId:"PieChartCanvas"}),g:t.f(o.groupBills,((e,a,n)=>({a:s.getCategoryColor(e.name),b:t.t(e.name),c:t.t(e.value.toString()),d:a}))),h:t.sr("columnChart","380879e3-1"),i:t.p({canvasId:"ColumnChart"})})}]]);wx.createPage(a);
