"use strict";const e=require("../../common/vendor.js"),t={components:{PieChart:()=>"../../components/Chart/PieChart.js",ColumnChart:()=>"../../components/Chart/ColumnChart.js"},data:()=>({columnChartData:{categories:["2018","2019","2020","2021","2022","2023"],series:[{name:"目标值",data:[35,36,31,33,13,34]},{name:"完成量",data:[18,27,21,24,6,28]}]},groupBills:[],chartData:{series:[{data:[{name:"一班",value:256},{name:"二班",value:123},{name:"三班",value:20},{name:"四班",value:0},{name:"五班",value:0}]}]},bills:[],billsInCurrentMouth:[],categories:[{name:"购物",color:"#ff6b6b",type:"expense",icon:"Groceries"},{name:"餐饮",color:"#48dbfb",type:"expense",icon:"Restaurant"},{name:"交通",color:"#f368e0",type:"expense",icon:"Transportation"},{name:"娱乐",color:"#ff9f1c",type:"expense",icon:"Party"},{name:"健康",color:"#eb3b5a",type:"expense",icon:"Health"},{name:"电子",color:"#f368e0",type:"expense",icon:"Electronics"},{name:"礼物",color:"#ff9f1c",type:"expense",icon:"Electronics"},{name:"起居",color:"#eb3b5a",type:"expense",icon:"Institute"}],currentDate:new Date}),onShow(){this.loadBills(),this.update()},computed:{currentMonth(){return`${this.currentDate.getFullYear()}年${this.currentDate.getMonth()+1}月`}},methods:{update(){var e,t;this.filterBillsByMonth(),this.updatePieChart(),this.updateColumnChart(),null==(e=this.$refs.pieChart)||e.drawCharts(this.chartData),null==(t=this.$refs.columnChart)||t.drawCharts(this.columnChartData)},loadBills(){const t=e.index.getStorageSync("bills")||[];this.bills=t},filterBillsByMonth(){const e=this.currentDate.getFullYear(),t=this.currentDate.getMonth();this.billsInCurrentMouth=this.bills.filter((a=>{const n=new Date(a.time);return n.getFullYear()===e&&n.getMonth()===t}))},updatePieChart(){const e=[];this.categories.forEach((t=>{const a={};a.name=t.name;const n=this.billsInCurrentMouth.filter((e=>e.category===t.name)).reduce(((e,t)=>e+Number(t.amount)),0).toFixed(2);a.value=Number(n),a.value>0&&e.push(a)}));var t={};const a={};a.data=e,t.series=[a],this.chartData=t,this.groupBills=e.sort(((e,t)=>t.value-e.value))},updateColumnChart(){const e={},t={},a=[];this.billsInCurrentMouth.forEach((n=>{const r=new Date(n.time).getDay().toString();"expense"===n.type?(e[r]||(e[r]=0,-1===a.findIndex((e=>e===r))&&a.push(r)),e[r]=e[r]+Number(n.amount)):(t[r]||(t[r]=0,-1===a.findIndex((e=>e===r))&&a.push(r)),t[r]=t[r]+Number(n.amount))}));const n=[],r=[];a.forEach((a=>{t[a]?n.push(t[a]):n.push(0),e[a]?r.push(e[a]):r.push(0)}));var o={};const s={name:"支出",data:r},i={name:"收入",data:n};o.categories=a,o.series=[s,i],this.columnChartData=o},changeMonth(e){const t=new Date(this.currentDate);t.setMonth(t.getMonth()+e),this.currentDate=t,this.update()},getCategoryColor(e){const t=this.categories.find((t=>t.name===e));return`/static/typeIcons/${t?t.icon:"Maintenance"}.png`}}};if(!Array){(e.resolveComponent("PieChart")+e.resolveComponent("ColumnChart"))()}const a=e._export_sfc(t,[["render",function(t,a,n,r,o,s){return e.e({a:e.o((e=>s.changeMonth(-1))),b:e.t(s.currentMonth),c:e.o((e=>s.changeMonth(1))),d:0===Object.keys(o.groupBills).length},(Object.keys(o.groupBills).length,{}),{e:e.sr("pieChart","380879e3-0"),f:e.p({canvasId:"PieChartCanvas"}),g:e.f(o.groupBills,((t,a,n)=>({a:s.getCategoryColor(t.name),b:e.t(t.name),c:e.t(t.value.toString()),d:a}))),h:e.sr("columnChart","380879e3-1"),i:e.p({canvasId:"ColumnChart"})})}]]);wx.createPage(a);
