"use strict";const t=require("../../common/vendor.js"),e={data:()=>({bills:[],categories:[{name:"购物",color:"#ff6b6b",type:"支出",icon:"Groceries"},{name:"餐饮",color:"#48dbfb",type:"支出",icon:"Restaurant"},{name:"交通",color:"#f368e0",type:"支出",icon:"Transportation"},{name:"娱乐",color:"#ff9f1c",type:"支出",icon:"Party"},{name:"健康",color:"#eb3b5a",type:"支出",icon:"Health"},{name:"电子",color:"#f368e0",type:"支出",icon:"Electronics"},{name:"礼物",color:"#ff9f1c",type:"支出",icon:"Electronics"},{name:"起居",color:"#eb3b5a",type:"支出",icon:"Institute"},{name:"工资",color:"#1dd1a1",type:"收入",icon:"Money"},{name:"理财",color:"#2ecc71",type:"收入",icon:"Savings"}],totalIncome:0,totalExpense:0,currentDate:new Date,groupedBills:{},currentPage:1,pageSize:10,totalPages:1,budget:t.index.getStorageSync("budget")||0}),computed:{currentMonth(){return`${this.currentDate.getFullYear()}年${this.currentDate.getMonth()+1}月`},balance(){return Number(this.budget)+Number(this.totalIncome)-Number(this.totalExpense)}},onShow(){this.loadBills(),this.budget=t.index.getStorageSync("budget")||1e3},methods:{loadBills(){const e=t.index.getStorageSync("bills")||[];this.bills=e,this.filterBillsByMonth()},filterBillsByMonth(){const t=this.currentDate.getFullYear(),e=this.currentDate.getMonth(),n=this.bills.filter((n=>{const o=new Date(n.time);return o.getFullYear()===t&&o.getMonth()===e}));this.totalPages=Math.ceil(n.length/this.pageSize),this.groupBillsByDate(n.slice(0,this.pageSize*this.currentPage)),this.calculateTotal(n)},groupBillsByDate(t){const e={};t.forEach((t=>{const n=new Date(t.time).toLocaleDateString();e[n]||(e[n]=[]),e[n].push(t)})),this.groupedBills=e},calculateTotal(t){this.totalIncome=t.filter((t=>"收入"===t.type)).reduce(((t,e)=>t+Number(e.amount)),0).toFixed(2),this.totalExpense=t.filter((t=>"支出"===t.type)).reduce(((t,e)=>t+Number(e.amount)),0).toFixed(2)},changeMonth(t){const e=new Date(this.currentDate);e.setMonth(e.getMonth()+t),this.currentDate=e,this.filterBillsByMonth()},formatDate(t){const e=new Date(t);return`${e.getFullYear()}年${e.getMonth()+1}月${e.getDate()}日`},formatTime(t){const e=new Date(t);return`${e.getHours()}:${e.getMinutes().toString().padStart(2,"0")}`},getCategoryColor(t){const e=this.categories.find((e=>e.name===t));return`/static/typeIcons/${e?e.icon:"Maintenance"}.png`},navigateTo(e){t.index.navigateTo({url:`/pages/${e}/${e}`})}}};if(!Array){t.resolveComponent("IconButton")()}Math;const n=t._export_sfc(e,[["render",function(e,n,o,a,r,i){return t.e({a:t.o((t=>i.changeMonth(-1))),b:t.t(i.currentMonth),c:t.o((t=>i.changeMonth(1))),d:t.t(r.totalIncome),e:t.t(r.totalExpense),f:t.t(r.budget),g:t.t(i.balance),h:t.n({positive:i.balance>=0,negative:i.balance<0}),i:0===Object.keys(r.groupedBills).length},(Object.keys(r.groupedBills).length,{}),{j:t.f(r.groupedBills,((e,n,o)=>({a:t.t(i.formatDate(n)),b:t.f(e,((e,n,o)=>t.e({a:i.getCategoryColor(e.category),b:t.t(e.category),c:e.remark},e.remark?{d:t.t(e.remark)}:{},{e:t.t("收入"===e.type?"+":"-"),f:t.t(e.amount),g:t.n("收入"===e.type?"income":"expense"),h:n}))),c:n}))),k:t.o((t=>i.navigateTo("statistics"))),l:t.p({iconSrc:"/static/statisticsBtn.png",label:"统计"}),m:t.o((t=>i.navigateTo("addBill"))),n:t.p({iconSrc:"/static/addBill.png",label:"添加"}),o:t.o((t=>i.navigateTo("settings"))),p:t.p({a:!0,iconSrc:"/static/settingsBtn.png",label:"设置"})})}]]);wx.createPage(n);
