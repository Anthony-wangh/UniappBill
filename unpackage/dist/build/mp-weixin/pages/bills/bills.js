"use strict";const e=require("../../common/vendor.js"),t={data:()=>({bills:[],categories:[{name:"购物",color:"#ff6b6b",type:"expense"},{name:"餐饮",color:"#48dbfb",type:"expense"},{name:"交通",color:"#f368e0",type:"expense"},{name:"娱乐",color:"#ff9f1c",type:"expense"},{name:"房屋",color:"#eb3b5a",type:"expense"},{name:"工资",color:"#1dd1a1",type:"income"},{name:"奖金",color:"#2ecc71",type:"income"}],totalIncome:0,totalExpense:0,currentDate:new Date,groupedBills:{},currentPage:1,pageSize:10,totalPages:1,budget:e.index.getStorageSync("budget")||0}),computed:{currentMonth(){return this.currentDate.toLocaleDateString("zh-CN",{year:"numeric",month:"long"})},balance(){return Number(this.budget)+Number(this.totalIncome)-Number(this.totalExpense)}},onShow(){this.loadBills(),this.budget=e.index.getStorageSync("budget")||0},methods:{loadBills(){const t=e.index.getStorageSync("bills")||[];this.bills=t,this.filterBillsByMonth()},filterBillsByMonth(){const e=this.currentDate.getFullYear(),t=this.currentDate.getMonth(),o=this.bills.filter((o=>{const n=new Date(o.time);return n.getFullYear()===e&&n.getMonth()===t}));this.totalPages=Math.ceil(o.length/this.pageSize),this.groupBillsByDate(o.slice(0,this.pageSize*this.currentPage)),this.calculateTotal(o)},groupBillsByDate(e){const t={};e.forEach((e=>{const o=new Date(e.time).toLocaleDateString();t[o]||(t[o]=[]),t[o].push(e)})),this.groupedBills=t},calculateTotal(e){this.totalIncome=e.filter((e=>"income"===e.type)).reduce(((e,t)=>e+Number(t.amount)),0).toFixed(2),this.totalExpense=e.filter((e=>"expense"===e.type)).reduce(((e,t)=>e+Number(t.amount)),0).toFixed(2)},changeMonth(e){const t=new Date(this.currentDate);t.setMonth(t.getMonth()+e),this.currentDate=t,this.filterBillsByMonth()},formatDate:e=>new Date(e).toLocaleDateString("zh-CN",{month:"long",day:"numeric"}),formatTime(e){const t=new Date(e);return`${t.getHours()}:${t.getMinutes().toString().padStart(2,"0")}`},getCategoryColor(e){const t=this.categories.find((t=>t.name===e));return t?t.color:"#cccccc"},navigateTo(t){e.index.navigateTo({url:`/pages/${t}/${t}`})}}};if(!Array){e.resolveComponent("IconButton")()}Math;const o=e._export_sfc(t,[["render",function(t,o,n,a,r,i){return e.e({a:e.o((e=>i.changeMonth(-1))),b:e.t(i.currentMonth),c:e.o((e=>i.changeMonth(1))),d:e.t(r.totalIncome),e:e.t(r.totalExpense),f:e.t(r.budget),g:e.t(i.balance),h:e.n({positive:i.balance>=0,negative:i.balance<0}),i:0===Object.keys(r.groupedBills).length},(Object.keys(r.groupedBills).length,{}),{j:e.f(r.groupedBills,((t,o,n)=>({a:e.t(i.formatDate(o)),b:e.f(t,((t,o,n)=>e.e({a:i.getCategoryColor(t.category),b:e.t(t.category),c:t.remark},t.remark?{d:e.t(t.remark)}:{},{e:e.t("income"===t.type?"+":"-"),f:e.t(t.amount),g:e.n("income"===t.type?"income":"expense"),h:o}))),c:o}))),k:e.o((e=>i.navigateTo("addBill"))),l:e.o((e=>i.navigateTo("statistics"))),m:e.p({iconSrc:"/static/qq.png",label:"统计"}),n:e.o((e=>i.navigateTo("settings"))),o:e.p({iconSrc:"/static/qq.png",label:"设置"})})}]]);wx.createPage(o);
